<script>
        lucide.createIcons();
        const supabaseUrl = 'https://eedegpggzooimuvytmyt.supabase.co'
        const supabaseKey = 'sb_publishable_7ib6PE-capYPhqdTrS0m2w_3d9QWE8x'
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey)
        let isLoginMode = true;

        function toggleMode() {
            isLoginMode = !isLoginMode;
            const camposExtras = document.getElementById('campos-extras');
            const titulo = document.getElementById('titulo-pagina');
            const btn = document.getElementById('btn-acao');
            const toggleText = document.getElementById('texto-toggle');
            if (isLoginMode) {
                camposExtras.classList.add('hidden');
                titulo.innerText = "Acessar sua conta";
                btn.innerText = "Entrar";
                toggleText.innerText = "Não tem uma conta? Criar agora";
            } else {
                camposExtras.classList.remove('hidden');
                titulo.innerText = "Criar sua conta";
                btn.innerText = "Criar Conta";
                toggleText.innerText = "Já tem uma conta? Fazer login";
            }
        }

        async function handleAuth() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const msg = document.getElementById('mensagem');
            const btn = document.getElementById('btn-acao');

            if (!email || !password) { msg.innerText = "Preencha e-mail e senha."; msg.style.color = "red"; return; }
            btn.innerText = "Processando..."; btn.disabled = true; msg.innerText = "";

            if (isLoginMode) {
                // --- LOGIN ---
                const { data, error } = await _supabase.auth.signInWithPassword({ email, password });
                
                if (error) { 
                    msg.innerText = "Erro: " + error.message; 
                    msg.style.color = "red"; 
                    btn.innerText = "Entrar"; 
                    btn.disabled = false; 
                } else { 
                    msg.innerText = "Login Sucesso! Redirecionando..."; 
                    msg.style.color = "green"; 
                    // AQUI ESTAVA O ERRO, AGORA ESTÁ CORRIGIDO PARA /dashboard
                    setTimeout(() => { window.location.href = "/dashboard" }, 1500); 
                }

            } else {
                // --- CADASTRO ---
                const { data: authData, error: authError } = await _supabase.auth.signUp({ email, password });
                if (authError) { msg.innerText = "Erro ao criar conta: " + authError.message; msg.style.color = "red"; btn.innerText = "Criar Conta"; btn.disabled = false; return; }
                if (authData.user) {
                    const { error: dbError } = await _supabase.from('clientes').insert({
                        id_auth: authData.user.id,
                        nome: document.getElementById('firstName').value,
                        sobrenome: document.getElementById('lastName').value,
                        cpf: document.getElementById('cpf').value,
                        nascimento: document.getElementById('birthDate').value,
                        cep: document.getElementById('cep').value,
                        rua: document.getElementById('street').value,
                        numero: document.getElementById('number').value,
                        bairro: document.getElementById('neighborhood').value,
                        cidade: document.getElementById('city').value,
                        estado: document.getElementById('state').value
                    });
                    if (dbError) { msg.innerText = "Erro ao salvar dados: " + dbError.message; msg.style.color = "orange"; console.log(dbError); }
                    else { msg.innerText = "Cadastro completo! Você já pode entrar."; msg.style.color = "green"; setTimeout(() => { toggleMode(); }, 2000); }
                }
                btn.innerText = "Criar Conta"; btn.disabled = false;
            }
        }
    </script>
